---
title: Building Dockerfile Images with Buildkit

description: |
  This guide shows how to install Buildkit for building Dockerfile images with
  Unikraft.
---

Unikraft uses [BuildKit][buildkit], along with [Dockerfiles][dockerfiles], to
construct the root filesystem used by applications.

We can install BuildKit either by running it natively via `systemd` or inside a
container. Please refer to [BuildKit's installation
instructions][buildkit-installation] for more information. For convenience, we
recommend running it inside a container.

We will also need a [container engine][container-engine] on our host. Popular
choices include [Docker][docker], [podman], and [containerd]. Please follow
their respective documentation to get them up and running. For the rest of this
article, we will assume Docker to be the installed container engine.

After installing the container engine, we can go ahead and run BuildKit.

```bash
docker run -d --name buildkitd --privileged moby/buildkit:latest
```

We can check if the container launched by doing:

```bash
$ docker container ps | grep buildkitd
```

```bash
b146031cd4db   moby/buildkit:latest   "buildkitd"   About a minute ago   Up About a minute      buildkit
```

Now, we instruct `kraft` to use the BuildKit instance we launched. We can do it
in the following ways:

- `KRAFTKIT_BUILDKIT_HOST` environment variable:
  ```bash
  export KRAFTKIT_BUILDKIT_HOST=docker-container://buildkitd
  ```
- KraftKit's configuration file (`~/.config/kraftkit/config.yaml`):
  ```yaml
  buildkit_host: docker-container://buildkitd
  ```
- Passing the `--buildkit-host` CLI flag to `kraft`:
  ```bash
  kraft --buildkit-host=docker-container://buildkitd <args>
  ```

> A container's URI depends on its name and the container engine. For example, a
> container managed by `podman` will have `podman-container://buildkitd` as its
> URI.

Since we gave a name to our container, we can use the `start` and `stop`
subcommands to spawn/stop our BuildKit instance on demand.

```bash
docker stop buildkitd   # Start the container
docker start buildkitd  # Stop the container
```

[buildkit]: https://docs.docker.com/build/buildkit/
[Dockerfiles]: https://docs.docker.com/reference/dockerfile/
[buildkit-installation]: https://github.com/moby/buildkit
[container-engine]:
  https://developers.redhat.com/blog/2018/02/22/container-terminology-practical-introduction#h.6yt1ex5wfo3l
[docker]: https://www.docker.com/
[podman]: https://docs.podman.io/en/latest/
[containerd]: https://containerd.io/
